# Отчет о рефакторинге навигации

**Дата:** 2 июля 2025  
**Статус:** ✅ Завершено и задеплоено

## Цель рефакторинга

Централизация системы навигации в соответствии с UI Guidelines для устранения "прыгающей" навигации и создания консистентного пользовательского опыта.

## Выполненные изменения

### 1. Централизация TabBar в AppShell

**Файл:** `lib/shared/widgets/main_shell.dart`

- ✅ Переименован `MainShell` → `AppShell`
- ✅ Добавлена централизованная логика TabBar для всех экранов
- ✅ Реализована поддержка студенческих табов: "Клуб" | "Учеба"
- ✅ Реализована поддержка админских табов: "Курсы" | "Пользователи" | "Домашки"
- ✅ Добавлена система breadcrumbs для Level 2+ навигации
- ✅ Реализована умная кнопка "Назад" с контекстной логикой
- ✅ Сохранен BottomNavigationBar только для админов (переключение между режимами)

### 2. Упрощение StudentNavigationScreen

**Файл:** `lib/features/student/presentation/screens/student_navigation_screen.dart`

- ✅ Убран TabController и TabBar (теперь в AppShell)
- ✅ Конвертирован из StatefulWidget в ConsumerWidget
- ✅ Изменен параметр `initialTabIndex` → `tabIndex`
- ✅ Упрощена логика отображения контента на основе параметра

### 3. Упрощение AdminDashboard

**Файл:** `lib/features/admin/presentation/screens/admin_dashboard.dart`

- ✅ Убран TabController и TabBar (теперь в AppShell)
- ✅ Конвертирован в ConsumerWidget
- ✅ Показывает только CourseManagementScreen как дефолтный контент

### 4. Обновление роутеров

**Файлы:** `lib/main.dart`, `lib/core/di/core/router/app_router.dart`

- ✅ Обновлены все ссылки на `AppShell`
- ✅ Исправлены параметры `tabIndex`
- ✅ Добавлен недостающий маршрут `/admin/homework`
- ✅ Исправлены дефолтные значения табов (по умолчанию "Учеба" вместо "Клуб")

## Архитектура навигации

### Level 0: Режим пользователя
- **BottomNavigationBar** (только для админов): "Учительская" | "Студенческая"

### Level 1: Основные разделы
- **Студенты:** TabBar "Клуб" | "Учеба"  
- **Админы:** TabBar "Курсы" | "Пользователи" | "Домашки"

### Level 2+: Вложенная навигация
- **Breadcrumbs** под TabBar показывают путь
- **Кнопка назад** возвращает в рамках текущего таба

## UI Guidelines соблюдены

- ✅ AppBar всегда показывает "Augmentek" + аватар пользователя
- ✅ TabBar всегда видимый на Level 1 экранах
- ✅ BottomNavigationBar только для админов (переключение режимов)
- ✅ Breadcrumbs для Level 2+ экранов
- ✅ Контекстная кнопка "Назад"
- ✅ Универсальный AppShell для всех экранов

## Результат

### До рефакторинга:
- ❌ TabBar появлялся/исчезал на разных экранах
- ❌ Несколько TabController в разных компонентах
- ❌ Неконсистентная навигация
- ❌ "Прыгающий" интерфейс

### После рефакторинга:
- ✅ Единый TabBar управляется из AppShell
- ✅ Консистентная навигация на всех экранах
- ✅ Четкая иерархия: Level 0 → Level 1 → Level 2+
- ✅ Стабильный интерфейс без "прыжков"

## Деплой

**URL:** https://augmentek-lms.web.app  
**Статус:** ✅ Успешно задеплоено в 16:54 UTC

## Технические детали

- Использован SingleTickerProviderStateMixin для TabController в AppShell
- Реализована автоматическая инициализация правильного таба на основе маршрута
- Добавлена логика показа/скрытия TabBar в зависимости от типа экрана
- Breadcrumbs с умным парсингом пути навигации
- Кнопка назад с контекстной логикой для разных типов экранов 